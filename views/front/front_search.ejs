<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', {title: "Frontpage - search"}) %>

  <body>
    <%- include('../partials/nav', {user: locals.user, karma, name:"Frontpage"})
    %>
    <span id="auth"><%= isAuth %></span>

    <div class="grid-container">
      <div class="sidebar">
        <form id="form-search" action="/search/" method="post">
          <div class="input-group mb-3">
            <input
              type="text"
              class="form-control"
              name="query"
              placeholder="Find a post"
              value="<%= query %>"
              required
            />
            <div class="input-group-append">
              <button class="btn btn-primary submit" type="submit"
                >Search</button
              >
            </div>
          </div>
        </form>
        <div class="btn-group" style="width: 100%">
          <a
            class="btn btn-success auth-req"
            href="/submit/link"
            id="submit-link"
            style="width: 100%"
            >New link</a
          >
          <a
            class="btn btn-primary auth-req"
            href="/submit/post"
            id="submit-post"
            style="width: 100%"
            >New post</a
          >
        </div>
        <br /><br />

        <a
          class="btn btn-block btn-light auth-req"
          href="/submit/subreddit"
          id="create-subreddit"
          >Create subbeddit</a
        ><br />

        <%- include('../partials/sidebar_index_subscribed', {isAuth,
        subscribed}) %>
      </div>

      <div class="main">
        <% if (posts != undefined) { %>
        <h4>Results (<%= posts.length %>)</h4>
        <% } %> <% if (posts != undefined) { posts.forEach((post) => { %>
        <article class="post" data-ref="<%= post._id %>">
          <div class="arrows">
            <div class="upvote-post auth-req"
              ><i class="far fa-caret-square-up"></i
            ></div>
            <span class="post-votes" data-ref="<%= post._id %>"
              ><%= post.votes %></span
            >
            <div class="downvote-post auth-req"
              ><i class="far fa-caret-square-down"></i
            ></div>
          </div>

          <% if(post.type == "img") { %>
          <a href="<%= post.link %>"
            ><img src="<%=post.link%>" height="55" width="55" class="thumbnail"
          /></a>
          <% } else if (post.type == "link") { %>
          <a href="<%= post.link %>"
            ><img
              src="/images/link.png"
              height="55"
              width="55"
              class="thumbnail"
          /></a>
          <% } else { %>
          <a href="/r/<%= post.subreddit %>/<%= post._id %>"
            ><img
              src="/images/post.png"
              height="55"
              width="55"
              class="thumbnail"
          /></a>
          <% } %>

          <div class="info">
            <header>
              <% if(post.type == "post") { %>
              <a href="/r/<%= post.subreddit %>/<%= post._id %>"
                ><%= post.title %></a
              >
              <% } else { %>
              <a href="<%= post.link %>"><%= post.title %></a>
              <% } %>
            </header>
            <div>
              submitted <time title="<%= post.time %>">-</time> by
              <span
                ><a href="/u/<%= post.username %>"
                  ><%= post.username %></a
                ></span
              >
              from
              <span
                ><a href="/r/<%= post.subreddit %>"
                  >/r/<%= post.subreddit %></a
                ></span
              >
            </div>
            <ul>
              <li
                ><a href="/r/<%=post.subreddit %>/<%= post._id %>"
                  >comments</a
                ></li
              >
              <li
                ><a href="javascript:void(0)" class="save-post auth-req"
                  >save</a
                ></li
              >
              <% if(post.username == locals.user) { %>
              <li
                ><a href="javascript:void(0)" class="delete-post auth-req">
                  <i class="fas fa-trash-alt"></i>
                  delete
                </a></li
              >
              <% } %>
            </ul>
          </div>
        </article>
        <% });%> <% } else { %>
        <h4>Results (0)</h4>
        There are no posts. <% } %>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/autosize@4.0.2/dist/autosize.min.js"></script>

    <script defer src="/js/load.js"></script>
    <script src="/js/index.js"></script>
    <script src="/js/post.js"></script>
  </body>
</html>
